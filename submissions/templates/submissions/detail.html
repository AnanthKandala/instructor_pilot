{% extends "base.html" %}
{% load crispy_forms_tags%}

{% block title %}

| {{ submission }}

{% endblock title %}

{% block content %}

    <div class="row">
        <div class="col-sm-12 w-100">
            <h5 class="text-muted">Attempt {{ submission.attempt }}</h5>
        </div>
        
        <div id="list-pages" class="col-sm-1 list-group mb-4">
            {% for image in submission.submissions_papersubmissionimage_related.all%} 
                <a class="list-group-item list-group-item-action" href="#page-{{forloop.counter}}">Page {{forloop.counter}}</a>
            {% endfor %}
        </div>

        <div class="col-sm-8">    
            <figure>
                <div data-bs-spy="scroll" data-bs-target="#list-pages" style="height:80vh; position:relative; overflow-y:scroll;" data-bs-offset="200" class="scrollspy-example" tabindex="0">
                {% for image in submission.submissions_papersubmissionimage_related.all%}  
                    <h4 id="page-{{forloop.counter}}"></h4>
                    <img src="{{ image.image.url }}" class="img-fluid" alt="{{ image.image.name }}" style="max-width:95%">
                {% endfor %}
                </div> 
            </figure>
        </div>

        <div class="col-sm-3">
            <form action="/submissions/{{ submission.pk }}/" method="post">
                {% csrf_token %}
                <div class="row" >                    
                    <div class="col-xs-12 mb-5" style="height:30%;">
                        {% if grading_form.non_field_errors %}
                            <div class="alert alert-danger">
                                {{ grading_form.non_field_errors }}
                            </div>
                        {% endif %}
                        <div class="form-group">
                            <select class="form-select w-auto" name="student" id="id_student">
                                {% for section in submission.assignment.course.sections.all %}
                                    {% for student in section.students.all %}
                                        {% if student.pk == submission.student.pk %}
                                            <option value="{{ student.pk }}" selected>{{student}} ({{student.uni_id}})</option>
                                        {% else %}
                                            <option value="{{ student.pk }}">{{student}} ({{student.uni_id}})</option>
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-outline">
                            {{ grading_form.question_grades.errors }}
                            {% for q_grade, q_max_grade in grades_zipped %} 
                                <label class="mt-3" for="id_grade_question_{{forloop.counter}}" style="font-size:20px;">Question {{forloop.counter}}</label>
                                <div class="input-group mt-2">
                                    <input autofocus placeholder="?" name="grade_{{forloop.counter}}" type="number" id="id_grade_question_{{forloop.counter}}" step="1" class="form-control" value="{{ q_grade }}" style="max-width:80px;">
                                    <span class="input-group-text mt"> / {{ q_max_grade }}</span>
                                </div>
                            {% endfor %}
                            {% comment %} {{ form.grade }} {% endcomment %}
                        </div>
                    </div>
                    <div class="col-xs-12 mb-5" style="height:70%;">
                        <div class="form-outline">
                            {{ grading_form.grader_comments.errors }}
                            <label for="{{ grading_form.grader_comments.id_for_label }}" style="font-size:20px;">Comment</label>
                            <textarea name="grader_comments" class="form-control" id="{{ grading_form.grader_comments.id_for_label }}" rows="7">{{submission.grader_comments}}</textarea>
                        </div>
                    </div>
                    
                    <div class="col-xs-12 mb-3" style="height:70%;">
                        <div class="form-outline">
                            {{ grading_form.comment_files.errors }}
                            <label for="{{ grading_form.comment_files.id_for_label }}" style="font-size:20px;">File</label>
                            <input type="file" name="comment_files" class="form-control" id="{{ grading_form.comment_files.id_for_label }}">
                        </div>
                    </div>
                    <div class="col-xs-12" style="height:70%;">
                        <input class="btn btn-primary" type="submit" value="Update">
                    </div>
                    
                </div>
            </form>
        </div>
    </div>

{% endblock content %}