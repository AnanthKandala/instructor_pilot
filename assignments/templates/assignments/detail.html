{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags%}

{% block scripts %}
{% comment %} url for previous next to json_script {% endcomment %}
    
    <script src="{% static 'assignments/detail.js' %}" defer></script>
{% endblock scripts %}

{% block title %}

| {{ assignment.name }}

{% endblock title %}

{% block content %}
    <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
        <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="{{assignment.course.get_absolute_url}}">{{assignment.course.course_code}}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{assignment.name}}</li>
        </ol>
    </nav>

<h1> {{assignment.name}} </h1>

{% if assignment.description %}
    <p> {{assignment.description}} </p>
{% endif %}

{% comment %} list assignment submissions {% endcomment %}
<div class="row mt-4">
    {% if qs %}
        {% if assignment.canvas_id %}
        <div class="col-md-6 border-end mb-5">
            <div class="row">
                <div class="col-md-6">
                    <p class="mt-3"> Classify submissions based on student ID using Tensorflow</p>
                    <form action="" method="POST">
                        {% csrf_token %}
                        <button type="submit" name="submit-classify" class="btn btn-primary">Classify</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <p class="mt-3"> Sync Labeled Submissions from Canvas </p>
                    <form action="" method="POST" id="sync-from-form">
                        {% csrf_token %}
                        <button type="submit" id="btnFetch" class="btn btn-primary">Sync</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <p class="mt-3"> Upload graded submissions and comments to Canvas </p>
                    <form action="" method="POST">
                        {% csrf_token %}
                        <button type="button" name="submit-sync-to" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#syncToModal">Post to Canvas</button>
                    
                        <div class="modal fade" id="syncToModal" tabindex="-1" aria-labelledby="syncToModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="syncToModalLabel">Upload to Canvas</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                  This action will post all graded submissions and comments to Canvas. Specifically, 
                                  the script retrieve all submissions of {{assignment.name}} on Canvas, and then for each submission:
                                    <ul>
                                        <li>Get the corresponding submission in our database with the same canvas ID. If no matching canvas ID is found, this submission will be skipped.</li>
                                        <li>Check if the submission is graded in our database. If it is not graded, this submission will be skipped.</li>
                                        <li>Post the submission grade on Canvas. If the submission is already graded on Canvas, the grade is overwriten.</li>
                                        <li>Post a comment on Canvas with the individual question scores. This does <em>not</em> overwrite any previous submitted comments.</li>
                                        <li>Post all comments in the database corresponding to this submission. These do <em>not</em> overwrite any previous submitted comments.</li>
                                        <li>Update the submission PDF file to Canvas attached to a new submission comment.</li>
                                    </ul>
                                  Are you sure you want to continue?
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" name="submit-sync-to" class="btn btn-primary">Post</button>
                                </div>
                              </div>
                            </div>
                          </div>
                    
                    </form>
                </div>
                
            </div>
        </div>
        
        <div class="col-md-6 d-flex justify-content-center">
            {% crispy search_form %}
        </div>
        {% endif %}
        {% if message %}
            <div class="col-md-12 mt-5">
                <div class="alert id='myMessage' alert-{{message_type}}">
                    {{ message }}
                </div>
            </div>
        {% endif %}
        {% include "submissions/main.html" with object_list=qs title="Submissions" %}
    {% else %}
        <h3>No submissions found</h3>
        {% include "submissions/upload_files.html" with form=upload_form message="Upload submissions" %}
    {% endif %}
</div>

{% endblock content %}


